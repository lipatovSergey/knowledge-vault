## 2025-08-25 — Using `agent` in tests for automatic cookie handling

**Feature goal:**  
Simplify authentication flow in tests by using `agent`, which behaves like a browser and automatically stores and sends cookies with each request.

**Contract:**  
- Library: `supertest`  
- Replacement: manual cookie handling → `request.agent`  
- Behavior: cookies persist across requests automatically

### Development steps
1. **Previous approach (manual cookie handling):**
   ```js
   beforeEach(async () => {
     await request(global.app).post("/api/users").send({
       name: "User",
       email: "test@example.com",
       password: "pass123",
     });
     const res = await request(global.app).post("/api/users/login").send({
       email: "test@example.com",
       password: "pass123",
     });
     // saving cookie manually
     cookie = res.headers["set-cookie"];
   });
   
   // manually passing cookie with every request
   const res = await request(global.app).get(route).set("Cookie", cookie);
	```

2. **Updated approach (with `agent`):**

   ```js
   let agent;

   beforeEach(async () => {
     agent = request.agent(global.app);
     await agent.post("/api/users").send({
       name: "User",
       email: "test@example.com",
       password: "pass123",
     });
     await agent.post("/api/users/login").send({
       email: "test@example.com",
       password: "pass123",
     });
   });

   const res = await agent.get(route);
   ```

### Result

* Authentication state is preserved automatically, just like in a real browser.
* Tests became cleaner and easier to read.
* No need to manually extract and pass cookies anymore.

