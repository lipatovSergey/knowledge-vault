## 2025-08-25 — Test setup: simplify for `mongodb-memory-server` only

**Feature goal:**  
Clean up `tests/test.setup.js` to support a single testing mode — `mongodb-memory-server` — and remove dead code related to `connect-mongo` that never runs in tests.

**Context / Contract:**  
- Test DB: `mongodb-memory-server` (sets `process.env.MONGO_URI` via `startMemoryMongo`)  
- App DB connect: reuse the regular `connectDB()` (reads `MONGO_URI`)  
- App boot: require `../src/app` after DB is connected  
- Collection reset between tests

### Before
```js
	// ...init...
	({ store } = require("../src/middleware/session.middleware"));
	// Fallback connect if not ready
	if (mongoose.connection.readyState !== 1) {
		await mongoose.connect(process.env.MONGO_URI);
	}
	// After all: close session store if exists, disconnect, stop memory mongo
	if (store && typeof store.close === "function") {
		try { await store.close() } catch (err) {
			if (err?.name !== "MongoClientClosedError") throw err;
		}
	}
	await mongoose.disconnect();
	await stopMemoryMongo();
```

### After

```js
	jest.setTimeout(60_000);
	process.env.NODE_ENV = "test";

	const mongoose = require("mongoose");
	const { startMemoryMongo, stopMemoryMongo } = require("./utils/memory-mongo.js");

	beforeAll(async () => {
		await startMemoryMongo();                         // 1) start in-memory and set MONGO_URI
		const connectDB = require("../src/config/db");    // 2) connect using regular connectDB
		await connectDB();
		const app = require("../src/app");                // 3) build app (test routes enabled)
		global.app = app;
	});

	afterEach(async () => {
		if (!mongoose.connection?.db) return;
		const collections = await mongoose.connection.db.collections();
		await Promise.all(collections.map((c) => c.deleteMany({})));
	});

	afterAll(async () => {
		await mongoose.disconnect();
		await stopMemoryMongo();
	});
```

### Why this change
* The removed logic (`store` handling, fallback `mongoose.connect`, and session store closing) was only relevant if tests used `connect-mongo`.
* Current tests **only** use `mongodb-memory-server`, so that code never executed and added noise/confusion.

### Result
* Simpler, clearer test bootstrap focused on the actual test environment.
* Fewer moving parts; easier to maintain and reason about.
* Same isolation guarantees: DB is reset between tests and fully torn down after the suite.

### Future work
* If we migrate tests to `connect-mongo`, we’ll need to:

  * Initialize the session store from the same Mongo client,
  * Capture and close the store in `afterAll`,
  * Possibly reintroduce readiness checks depending on startup order.

